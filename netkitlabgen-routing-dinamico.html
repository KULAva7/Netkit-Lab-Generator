<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Lykon, Lollo, Neeja" />
    <title>Netkit Lab Generator</title>
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" />

    <script src="js/angular.min.js"></script>
    <script>
        if (typeof(angular)=="undefined")
            document.write('<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.4.7/angular.min.js"><\/script>');
    </script>
    <script src="js/jszip.min.js"></script>
    <script>
        if (typeof(JSZip)=="undefined")
            document.write('<script src="https://raw.githubusercontent.com/Stuk/jszip/master/dist/jszip.min.js"><\/script>');
    </script>
    <script src="js/FileSaver.min.js"></script>
    <script>
        if (typeof(saveAs)=="undefined")
            document.write('<script src="https://raw.githubusercontent.com/eligrey/FileSaver.js/master/FileSaver.min.js"><\/script>');
    </script>

    <style>
        body {
            padding: 10px;
        }
        .ng-hide {
            display: none;
            visibility: hidden;
            opacity: 0;
        }
        .form-control {
            border-radius: 0;
            padding: 2px 6px;
            margin-top: -2px;
            margin-bottom: 2px;
            height: 26px;
        }
        ::-webkit-input-placeholder {
            color: #9a9a9a !important;
        }
        ::-webkit-input-placeholder:before {
            content: "suggerimento: " !important;
            font-size: 80%;
            color: #9a9a9a !important;
        }
        :-moz-placeholder {
            color: #c1c1c1 !important;
            opacity:1;
        }
        ::-moz-placeholder {
            color: #c1c1c1 !important;
            opacity:1;
        }
        ::-moz-placeholder:before {
            content: "suggerimento: " !important;
            font-size: 80%;
            color: #c1c1c1 !important;
            opacity:1;
        }
        :-ms-input-placeholder {
            color: #c1c1c1 !important;
        }
        .btn {
            margin: 2px 0;
            padding: 4px 3px;
            border-radius: 0;
        }
        .btn-square {
            height: 22px;
            width: 22px;
            padding: 0;
        }
        .btn-danger.disabled, .btn-danger.disabled.active, .btn-danger.disabled.focus, .btn-danger.disabled:active, .btn-danger.disabled:focus, .btn-danger.disabled:hover, .btn-danger[disabled], .btn-danger[disabled].active, .btn-danger[disabled].focus, .btn-danger[disabled]:active, .btn-danger[disabled]:focus, .btn-danger[disabled]:hover, fieldset[disabled] .btn-danger, fieldset[disabled] .btn-danger.active, fieldset[disabled] .btn-danger.focus, fieldset[disabled] .btn-danger:active, fieldset[disabled] .btn-danger:focus, fieldset[disabled] .btn-danger:hover {
            background-color: #9e9e9e;
            border-color: #808080;
            opacity: 0.2 !important;
        }
        table {
            border-collapse: separate; border-spacing: 0 2px; box-sizing: border-box;
        }
        tr td:first-child, tr th:first-child { border-bottom-left-radius: 1px; border-top-left-radius: 1px; }
        tr td:last-child, tr th:last-child { border-bottom-right-radius: 1px; border-top-right-radius: 1px; }
        tr {
            background-color: rgba(0, 0, 0, 0.01);
        }
        td, th {
            border: solid 1px #aaa;
            border: solid 1px rgba(0, 0, 0, 0.2);
            padding: 10px;
        }
        strong {
            font-size: 120%;
            padding: 0 5px;
        }
        .hidelasthr:last-child hr {
            visibility:hidden;
            opacity:0;
            display:none;
        }
        th {
            color: #fff;
            background-color: #337ab7;
            border-color: #2e6da4;
        }
        hr {
            margin: 5px 0;
            width:100%;
        }
        h1,h2,h3,h4,h5{
            width:100%;
        }
        label {
            margin-bottom: 0;
        }
        pre {outline: 1px solid #ccc; padding: 5px; border-radius: 0; width:100%; display:block }
        textarea {
            width:100%;
            font-size: 14px;
            line-height: 1.4;
            color: #555;
            background-color: #fff;
            background-image: none;
            border: 1px solid #ccc;
            -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
            box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
            -webkit-transition: border-color ease-in-out .15s,-webkit-box-shadow ease-in-out .15s;
            -o-transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
            transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
        }
        .string { color: green; }
        .number { color: darkorange; }
        .boolean { color: blue; }
        .null { color: magenta; }
        .key { color: red; }
        .hidden {visibility:hidden; display:none; opacity:0;}
        .browserupgrade {
            margin: 0.2em 0;
            background: #ffff00;
            color: #000;
            padding: 0.2em 0;
        }
        .file {
            width:300px;
            margin-top: 3px;
        }
        .fakefile {
            display: inline;
            width: 200px;
            background-color: white !important;
            margin-top: 2px;
        }
        .btn-short {
            height: 26px;
            padding: 2px;
            margin-top: -1px;
        }
        /*firefox only*/
        @-moz-document url-prefix() {
            .btn-short {
                margin-top: 0;
            }
        }
        #description {
            text-align: justify;
        }
        /* heavy stuff */
        .bg-logos {
            padding: 10px;
            background: white no-repeat top right url('data:image/gif;base64,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');
        }
        input {
            border-radius: 0;
            background-position: right center;
            background-repeat: no-repeat;
        }
        input:required:invalid, input:focus:invalid, textarea:required:invalid, input:invalid {
            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAT1JREFUeNpi/P//PwMpgImBRMACY/x7/uDX39sXt/67cMoDyOVgMjBjYFbV/8kkqcCBrIER5KS/967s+rmkXxzI5wJiRSBm/v8P7NTfHHFFl5mVdIzhGv4+u///x+xmuAlcdXPB9KeqeLgYd3bDU2ZpRRmwH4DOeAI07QXIRKipYPD35184/nn17CO4p/+cOfjl76+/X4GYAYThGn7/g+Mfh/ZZwjUA/aABpJVhpv6+dQUjZP78Z0YEK7OezS2gwltg64GmfTu6i+HL+mUMP34wgvGvL78ZOEysf8M1sGgZvQIqfA1SDAL8iUUMPIFRQLf+AmMQ4DQ0vYYSrL9vXDz2sq9LFsiX4dLRA0t8OX0SHKzi5bXf2HUMBVA0gN356N7p7xdOS3w5fAgcfNxWtn+BJi9gVVBOQfYPQIABABvRq3BwGT3OAAAAAElFTkSuQmCC');
        }
        input:required:valid {
            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAZZJREFUeNpi/P//PwMpgImBRMAy58QshrNPTzP8+vOLIUInisFQyYjhz98/DB9/fmT48/+35v7H+8KNhE2+WclZd+G0gZmJmYGThUNz1fUVMZtvbWT59eUXG9wGZIWMUPj993eJ5VeWxuy8veM/CzPL3yfvH/9H0QBSBDYZyOVm4mGYfn6q4cory5lYmFh+MrEwM/76/YsR7mk2ZjbWP///WP37/y8cqIDhx58fjvtu7XV6//ndT34G/v8FasUsDjKO/+A2PP3wpGLd+TVsfOz8XH6KAT+nHpokcu7h6d9q/BoMxToVbBYqlt9///+1GO4/WVdpXqY/zMqXn13/+vTjI9mj94/y//v9/3e9ZRObvYbDT0Y2xnm///x+wsfHB3GSGLf41jb3rv0O8nbcR66d+HPvxf2/+YZFTHaqjl8YWBnm/vv37yly5LL8+vuLgYuVa3uf/4T/Kd8SnSTZpb6FGUXwcvJxbAPKP2VkZESNOBDx8+9PBm4OwR1TwmYwcfzjsBUQFLjOxs52A2YyKysrXANAgAEA7buhysQuIREAAAAASUVORK5CYII=');
        }
        input:valid {
            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpCMUU2QjQ1RjhCRUUxMUU1ODdBQUU3MUJBOUZBMDU1MyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpCMUU2QjQ2MDhCRUUxMUU1ODdBQUU3MUJBOUZBMDU1MyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkIxRTZCNDVEOEJFRTExRTU4N0FBRTcxQkE5RkEwNTUzIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkIxRTZCNDVFOEJFRTExRTU4N0FBRTcxQkE5RkEwNTUzIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+WXXDRQAAAWBJREFUeNqUkT9rwlAUxW/eyx8kdHByCAFLhICgKYqDa8XNJX4LJ0c/kpBF8gG0Lg62FnHQZnARuySLOojEvCS9r9DQgh288JbHOff83nlCmqZwzxC4c0TXdcHzPIiiCFqtFpTLZWCMwfl8hjiOC6vVyjIMI6pUKi//JlBKQZblwnQ6rc1mM3K5XGiWcMsQhuHDeDyuzefzVBTF1Pd9uGkghICiKDAajbTJZCJgUozXAsfNNLiBJklSxPPEUa7Xa2mxWJSOxyPj5k6nQyzLyqoUgyB4xniqqqrUbDaZ4zjqZrNJNE2DbrdLURxhCe+ZYbfbfeq6bqzX63A4HOqHw4FzMy6uVqsMU98Q6ZQh5fP5j16vt8VN8nK5TPb7fWLbtlCv10MUvyLq6ffnEv4gZPX6/f7WNE2p0WhAu91WEHGLJZww7buIPy1xUy6X8waDAW/mEVN9FAU/myVJygxfAgwAp6GboqaPmLwAAAAASUVORK5CYII=');
        }
        input[type=file] {
            background-image: none;
        }

        /*===============================================================================================================

         Fine Style

         ================================================================================================================*/
    </style>

    <link rel="shortcut icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABjUlEQVQ4ja2RsW7aQByHP87ns2Mj180YlQeIOrBU4nmKisQ7IPECDCwMTHkIxIY6MdKFocrGGzTCjm2dzz6lA9gNahQpaX/TXyd99/3vd/CP6ex2u6/H4/HuHayN4/hbZ7PZ6H6/71VV9SbadV32+/2TNMZ4VVUxHo//XG3tX0Ce59T1EwDX1x9YLpcYYzoSoCxLAKbTKdvtlsPh0IJJklAUBdY6APi+z+Nj2jKiGQDm8zmDwYCbm08kSUKSJKSpJssMAN1uhFJXuK6iEQuAuq6x1jIajVitVtzf/2Q4HHJ7+xmtNb7v0+1GCOGgVIDv+9R1DYB8/t7FYkEQBFhrmc1mWOtcgEI4CCGQUrVdSQCtNXmeE8cxRVGcWw4JwyuUCk4m6QLgeQFZ9oDW+nRelmVbSFmWGGPOZX28sHpe0G4qhEPDyedfZYzBWovrhigVIKV7Ab4U2awShiFpmp7tDvALKRVZ9tBam3jeadZaIxtoMpm8anopaZoioyj6sV6vv7yZBnq93vf3cP83vwGLvrOpZ8u5AwAAAABJRU5ErkJggg==" />
</head>
<body class="bg-logos">
<script>
    var isIE = navigator.userAgent.indexOf('MSIE')!==-1 || navigator.appVersion.indexOf('Trident/') > 0;
    if (isIE)
        document.write('<p class="browserupgrade"><strong>Internet Explorer<\/strong> is not supported. Please upgrade your browser to <a href="https://www.google.com/chrome/browser/desktop/">Chrome<\/a> or <a href="https://www.mozilla.org/firefox/new/">Firefox<\/a>.<\/p>');
</script>
<h1>Netkit Lab Generator</h1>
<hr />
<div id="description">
    Questo tool permette di generare rapidamente i file e le cartelle necessari a far funzionare un laboratorio di Netkit.
    Lo scopo è la rapidità, quindi moltissime funzionalità opzionali non sono personalizzabili tramite questo form e sono settate a valori di
    default (ad esempio username e password di zebra). <strong>Gli autori di quest'applicazione non si assumono nessuna responsabilità
    riguardo eventuali malfunzionamenti</strong>.
    <br />
    Una volta compilato correttamente il form è possibile esportare il lab in formato .zip oppure tramite uno script bash che,
    al termine della sua esecuzione, provvederà a generare il lab e tutti i relativi file e cartelle. Inoltre è possibile esportare
    la configurazione del form in modo da importarla in un secondo momento ed effettuare modifiche.
</div>
<hr />
<div data-ng-app="napp" data-ng-controller="nc">

    <table id="netkit">
        <tr>
            <th>Info Macchina</th>
            <th>Interfacce di Rete</th>
            <th>Gateway (statico):</th>
            <th colspan="4">Funzioni aggiuntive:</th>
        </tr>

        <tr data-ng-repeat="x in netkit track by $index">
            <td>
                <div><label>Macchina {{x.row}}:</label>
                    <input type="text" data-ng-model="x.name" class="form-control" placeholder="pc" required /></div>
                <input title="type" type="radio" value="terminale" data-ng-model="x.type" /> Terminale<br />
                <input title="type" type="radio" value="router" data-ng-model="x.type" /> Router<br />
                <input title="type" type="radio" value="ns" data-ng-model="x.type" /> Name Server<br />
                <input title="type" type="radio" value="ws" data-ng-model="x.type" /> Web Server<br />
            </td>
            <td class="interfaces">
                <div class="btn btn-success" data-ng-click="addInterface(x)">Aggiungi interfaccia</div>
                <div class="btn btn-danger" data-ng-click="removeInterface(x)" data-ng-disabled="x.interfaces.counter<=1">Rimuovi ultima interfaccia</div><br />
                <div class="hidelasthr" data-ng-repeat="i in x.interfaces.if">
                    <div><label>Eth{{i.eth.number}}: </label>
                        <input type="text" data-ng-model="i.eth.domain" class="form-control" placeholder="A" required /></div>
                    <div><label> IP/Net: </label>
                        <input type="text" data-ng-model="i.ip" class="form-control" placeholder="0.0.0.0/0" required pattern="((^|\.)((25[0-5])|(2[0-4]\d)|(1\d\d)|([1-9]?\d))){4}/[0-9]+$" /></div>
                    <div><label> Nome DNS Completo: </label>
                        <input type="text" data-ng-model="i.name" class="form-control" placeholder="www.x.y. o ROOT-SERVER." pattern=".*\.$"/></div>
                    <hr />
                </div>
            </td>
            <td class="gateways">
                <div class="btn btn-success" data-ng-click="addGateway(x)">Aggiungi gateway</div>
                <div class="btn btn-danger" data-ng-click="removeGateway(x)" data-ng-disabled="x.gateways.counter<=1">Rimuovi ultimo gw</div><br />
                <div class="hidelasthr" data-ng-repeat="j in x.gateways.gw">
                    <div><label>Route (vuoto per default gw):</label>
                        <input type="text" data-ng-model="j.route" class="form-control" placeholder="0.0.0.0/0" pattern="((^|\.)((25[0-5])|(2[0-4]\d)|(1\d\d)|([1-9]?\d))){4}/[0-9]+$" /></div>
                    <div><label>GW (vuoto per non generare nulla):</label>
                        <input type="text" data-ng-model="j.gw" class="form-control" placeholder="0.0.0.0" pattern="((^|\.)((25[0-5])|(2[0-4]\d)|(1\d\d)|([1-9]?\d))){4}$" /></div>
                    <div><label>Interface:</label>
                        <select title="eth" data-ng-model="j.if" class="form-control">
                            <option data-ng-repeat="i in x.interfaces.if" value="{{i.eth.number}}">eth{{i.eth.number}}</option>
                        </select></div>
                    <hr />
                </div>
            </td>
            <td  data-ng-show="x.type=='ns'">
                <div>
                    <div><input title="auth" type="checkbox" value="1" data-ng-model="x.ns.authority" /> Sono un Nameserver Authority<br />
                    </div>
                    <div data-ng-show="x.ns.authority"><label>Zona (Root &egrave; .):</label>
                        <input type="text" data-ng-model="x.ns.zone" class="form-control" required placeholder=".com." pattern="(^\..*\.$)|^.$" /></div>
                    <div><input title="rec" type="checkbox" value="1" data-ng-model="x.ns.recursion" /> Abilita risoluzioni ricorsive<br />
                    </div>
                </div>
            </td>
            <td data-ng-show="x.type=='ws'">
                <input title="userdir" type="checkbox" value="1" data-ng-model="x.ws.userdir" /> Enable <strong>userdir</strong> module?
            </td>
            <td data-ng-show="x.type=='terminale'">
                <label>DNS di riferimento:</label>
                <select title="en" data-ng-model="x.pc.dns">
                    <option value="">-</option>
                    <optgroup data-ng-repeat="m in netkit" data-ng-if="m.type == 'ns'" label="{{m.name}}">
                        <option data-ng-repeat="ifn in m.interfaces.if" value="{{ifn.ip.split('/')[0]}}">{{ifn.ip.split('/')[0]}}</option>
                    </optgroup>
                </select>
            </td>
            <td data-ng-show="x.type=='router'">
                <label>Routing dinamico: </label><br /><br />
                <div><input title="en" type="checkbox" value="router" data-ng-model="x.routing.rip.en" /> rip</div>
                <div data-ng-show="x.routing.rip.en">
                    <span class="btn btn-success btn-square" data-ng-click="addRipNetwork(x)">+</span>
                    <span class="btn btn-danger btn-square" data-ng-click="removeRipNetwork(x)" data-ng-disabled="x.routing.rip.network.length<=1">-</span>
                    <div data-ng-repeat="rnet in x.routing.rip.network track by $index">
                        <label>Network: </label>
                        <input type="text" placeholder="0.0.0.0/0" required pattern="((^|\.)((25[0-5])|(2[0-4]\d)|(1\d\d)|([1-9]?\d))){4}/[0-9]+$" class="form-control" data-ng-model="x.routing.rip.network[$index]" />
                    </div>
                    <div><label>Route (vuoto per omettere): </label>
                        <input type="text" placeholder="0.0.0.0/0" pattern="((^|\.)((25[0-5])|(2[0-4]\d)|(1\d\d)|([1-9]?\d))){4}/[0-9]+$" class="form-control" data-ng-model="x.routing.rip.route" /></div>

                    <div><input title="redistributeo" type="checkbox" value="1" data-ng-model="x.routing.rip.ospf" /> redistribute ospf</div>
                    <div><input title="redistributec" type="checkbox" value="1" data-ng-model="x.routing.rip.connected" /> redistribute connected</div>
                </div>
                <hr />
                <input title="en" type="checkbox" value="ns" data-ng-model="x.routing.ospf.en" /> ospf<br />
                <div data-ng-show="x.routing.ospf.en">
                    <span class="btn btn-success btn-square" data-ng-click="addOspfNetwork(x)">+</span>
                    <span class="btn btn-danger btn-square" data-ng-click="removeOspfNetwork(x)" data-ng-disabled="x.routing.ospf.network.length<=1">-</span>
                    <div data-ng-repeat="onet in x.routing.ospf.network track by $index">
                        <div>
                            <label>Network: </label>
                            <input type="text" placeholder="0.0.0.0/0" required pattern="((^|\.)((25[0-5])|(2[0-4]\d)|(1\d\d)|([1-9]?\d))){4}/[0-9]+$" class="form-control" data-ng-model="x.routing.ospf.network[$index]" />
                        </div>
                        <div>
                            <label>Area: </label>
                            <input type="text" placeholder="0.0.0.0" required pattern="((^|\.)((25[0-5])|(2[0-4]\d)|(1\d\d)|([1-9]?\d))){4}$" class="form-control" data-ng-model="x.routing.ospf.area[$index]" />
                        </div>
                        <input title="stub" type="checkbox" value="1" data-ng-model="x.routing.ospf.stub[$index]" /> stub?
                    </div>

                    <div><input title="redistributer" type="checkbox" value="1" data-ng-model="x.routing.ospf.rip" /> redistribute rip</div>
                    <div><input title="redistributec" type="checkbox" value="1" data-ng-model="x.routing.ospf.connected" /> redistribute connected</div>
                    <label>Cost: </label>
                    <div data-ng-repeat="o in x.interfaces.if">
                        <div><input type="text" placeholder="0" class="form-control" data-ng-model="x.routing.ospf.if[o.eth.number].cost" pattern="[0-9]*" /></div>
                        <select title="eth" data-ng-model="x.routing.ospf.if[o.eth.number].interface" class="form-control" style="margin-bottom: 4px;">
                            <option data-ng-repeat="i in x.interfaces.if" value="{{i.eth.number}}">eth{{i.eth.number}}</option>
                        </select>
                    </div>
                </div>
            </td>
        </tr>

    </table>
    <div class="btn btn-success" data-ng-click="addMachine()">Aggiungi Macchina</div>
    <div class="btn btn-danger" data-ng-click="removeMachine()" data-ng-disabled="counter<=1">Rimuovi ultima Macchina</div><br />
    <a class="btn btn-primary" data-ng-click="makeDownload(generateScript(netkit), 'netkit.script')"><strong>Scarica il file .sh</strong></a>
    <a class="btn btn-primary" data-ng-click="generateZip(netkit)"><strong>Scarica il file .zip</strong></a>
    <br />
    <a class="btn btn-primary" data-ng-click="makeDownload(generateConfig(netkit), 'netkit.config')"><strong>Esporta configurazione</strong></a>
    <br />
    <a class="btn btn-primary" data-ng-click="import()"><strong>Importa configurazione</strong></a>
    <span class="file">
        <input type="file" id="file" name="file" class="form-control hidden"
               onchange="document.getElementById('file-text').value = lastElem(lastElem(this.value.split('/')).split('\\'));" />
        <input type="button" class="btn btn-default btn-short" onclick="document.getElementById('file').click();" value="Sfoglia..."><input id="file-text" type="text" class="form-control fakefile" title="file-text" onclick="document.getElementById('file').click();" readonly />
    </span>


    <br />
    <br />
    <hr />
    <br />

    <h4>Anteprima:</h4>
    <textarea title="script" rows="15" readonly>{{ generateScript(netkit) }}</textarea>

    <!--<div class="btn btn-success" onclick="debug()">Debug (non in tempo reale)</div>
    <div id="origin" class="hidden">{{netkit}}</div>
    <pre id="highlight"></pre>-->

</div>


<script>
    /*===============================================================================================================

     Script

     ================================================================================================================*/

    if (typeof JSON.clone !== "function") {
        JSON.clone = function(obj) {
            return JSON.parse(JSON.stringify(obj));
        };
    }

    function lastElem(arr) {
        return arr[arr.length - 1];
    }

    function highlight(json) {
        if (typeof json != 'string') {
            json = JSON.stringify(json, undefined, 4);
        }
        else {
            json = JSON.stringify(JSON.parse(json), undefined, 4);
        }
        json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
            var cls = 'number';
            if (/^"/.test(match)) {
                if (/:$/.test(match)) {
                    cls = 'key';
                } else {
                    cls = 'string';
                }
            } else if (/true|false/.test(match)) {
                cls = 'boolean';
            } else if (/null/.test(match)) {
                cls = 'null';
            }
            return '<span class="' + cls + '">' + match + '</span>';
        });
    }

    function debug() {
        var json = document.getElementById("origin").innerHTML;
        document.getElementById("highlight").innerHTML=highlight(json);
    }

    function makeFileStructure(nk) {
        var lab = [];
        lab["folder"] = [];
        lab["file"] = [];
        lab["warning"] = 0;
        lab["error"] = 0;

        for (var mindex in nk) {
            lab["folder"][nk[mindex].name] = "";
        }

        // generazione lab.conf
        lab["file"]["lab.conf"] = "";
        for (var mindex in nk) {
            for (var i in nk[mindex].interfaces.if) {
                lab["file"]["lab.conf"] += nk[mindex].name + "[" + nk[mindex].interfaces.if[i].eth.number + "]=" + nk[mindex].interfaces.if[i].eth.domain + "\n";
            }
            lab["file"]["lab.conf"] += "\n";
        }

        // generazione macchina.startup, resolver e apache
        for (var mindex in nk) {
            lab["file"][nk[mindex].name + ".startup"] = "";

            for (var i in nk[mindex].interfaces.if) {
                //ifconfig eth_ SELFADDRESS/MASK up
                lab["file"][nk[mindex].name + ".startup"] += "ifconfig eth" + nk[mindex].interfaces.if[i].eth.number +
                        " " + nk[mindex].interfaces.if[i].ip + " up\n";
            }

            for (var g in nk[mindex].gateways.gw) {
                if (typeof(nk[mindex].gateways.gw[g].gw) != "undefined" && nk[mindex].gateways.gw[g].gw != "") {
                    //route add default gw GATEWAY dev eth_
                    if (nk[mindex].gateways.gw[g].route == "") {
                        lab["file"][nk[mindex].name + ".startup"] += "route add default gw " +
                                nk[mindex].gateways.gw[g].gw + " dev eth" +
                                nk[mindex].gateways.gw[g].if + "\n";
                    }
                    //route add -net NETADDRESS/MASK gw GATEADDRESS dev eth_
                    else {
                        lab["file"][nk[mindex].name + ".startup"] += "route add -net " + nk[mindex].gateways.gw[g].route + " gw " +
                                nk[mindex].gateways.gw[g].gw + " dev eth" +
                                nk[mindex].gateways.gw[g].if + "\n";
                    }
                }
            }

            // ns
            if (nk[mindex].type == 'ns') {
                lab["file"][nk[mindex].name + ".startup"] += "/etc/init.d/bind start\n";
                lab["folder"][nk[mindex].name + "/etc/bind"] = "";
                lab["file"][nk[mindex].name + "/etc/bind/named.conf"] = "";
            }
            // ws
            else if (nk[mindex].type == 'ws') {
                if (nk[mindex].ws.userdir == true) {
                    lab["folder"][nk[mindex].name + "/home/guest/public_html"] = "";
                    lab["file"][nk[mindex].name + "/home/guest/public_html/index.html"] = '<html><head><title>Guest Home</title></head><body>Guest Home</body></html>';
                    lab["file"][nk[mindex].name + ".startup"] += "a2enmod userdir\n";
                }
                lab["file"][nk[mindex].name + ".startup"] += "/etc/init.d/apache2 start\n";
            }
            // terminale
            else if (nk[mindex].type == 'terminale') {
                if (typeof(nk[mindex].pc.ns) != "undefined" && nk[mindex].pc.ns != "") {
                    lab["folder"][nk[mindex].name + "/etc"] = "";
                    lab["file"][nk[mindex].name + "/etc/resolv.conf"] = "nameserver " + nk[mindex].pc.dns + "\n";
                }
            }
            // router
            else if (nk[mindex].type == 'router') {

            }
        }

        //Gestione Nameserver
        //variabili d'appoggio comuni ai vari cicli
        var authority = [];
        var root;
        //Trovo il root-ns e lo salvo
        for (var mindex in nk) {
            if(nk[mindex].type=="ns" && nk[mindex].ns.authority && nk[mindex].ns.zone == "."){
                root = nk[mindex];
            }
        }
        //Se non ho root-ns evito di generare una configurazione incoerente
        //db.root in ogni macchina dns
        if(typeof(root)!="undefined"){

            for (var mindex in nk) {
                if(nk[mindex].type=='ns'){
                    lab["file"][nk[mindex].name + "/etc/bind/db.root"] = "";
                    if(nk[mindex].ns.authority && nk[mindex].ns.zone == "."){
                        lab["file"][nk[mindex].name + "/etc/bind/db.root"] += "$TTL   60000\n@    IN SOA "+root.interfaces.if[0].name +
                                " root."+root.interfaces.if[0].name + " 2006031201 28800 14400 3600000 0\n\n";
                    }
                    if(nk[mindex].ns.recursion){
                        lab["file"][nk[mindex].name + "/etc/bind/named.conf"] += 'options {\n allow-recursion {0/0; };\n};\n\n';
                    }
                    lab["file"][nk[mindex].name + "/etc/bind/db.root"] += ".    IN NS "+root.interfaces.if[0].name+"\n";
                    lab["file"][nk[mindex].name + "/etc/bind/db.root"] += root.interfaces.if[0].name+"    IN A "+root.interfaces.if[0].ip.split("/")[0]+"\n";
                    if(nk[mindex].ns.authority && nk[mindex].ns.zone == "."){
                        lab["file"][nk[mindex].name + "/etc/bind/named.conf"] += 'zone "." {\n type master;\n file "/etc/bind/db.root";\n};\n\n';
                    } else {
                        lab["file"][nk[mindex].name + "/etc/bind/named.conf"] += 'zone "." {\n type hint;\n file "/etc/bind/db.root";\n};\n\n';
                    }
                }
            }
            //entry in db.zona e named.conf per le altre macchine
            for (var mindex in nk) {
                if(nk[mindex].type=="ns" && nk[mindex].ns.authority){
                    authority[nk[mindex].ns.zone] = nk[mindex];
                    if(nk[mindex].ns.zone != "."){
                        lab["file"][nk[mindex].name + "/etc/bind/db"+nk[mindex].ns.zone.slice(0,-1)] = "$TTL   60000\n@    IN SOA "+nk[mindex].interfaces.if[0].name + " root."+nk[mindex].interfaces.if[0].name + " 2006031201 28800 14400 3600000 0\n\n"; //ho preso il nome dell'interfaccia eth0
                        lab["file"][nk[mindex].name + "/etc/bind/named.conf"] += 'zone "'+nk[mindex].ns.zone.slice(1,-1)+'" {\n type master;\n file "/etc/bind/db'+nk[mindex].ns.zone.slice(0,-1)+'";\n};\n\n';
                    }
                }
            }
            //entry per l'alberatura delle zone (. conosce .com, .com conosce pippo.com, ecc)
            for (var mindex in nk) {
                for (var f in nk[mindex].interfaces.if){
                    var ip = nk[mindex].interfaces.if[f].ip.split("/")[0];
                    if(typeof(nk[mindex].interfaces.if[f].name)!="undefined"){

                        //Caso particolare per ns di primo livello
                        if( (typeof(nk[mindex].ns.zone) != "undefined") && nk[mindex].type=="ns" && nk[mindex].ns.authority && nk[mindex].ns.zone.split(".").length == 3) {
                            lab["file"][authority["."].name + "/etc/bind/db.root"] += nk[mindex].ns.zone.substring(1) + "    IN NS " + nk[mindex].interfaces.if[f].name + "\n";
                            lab["file"][authority["."].name + "/etc/bind/db.root"] += nk[mindex].interfaces.if[f].name + "    IN A " + ip + "\n";
                            lab["file"][nk[mindex].name + "/etc/bind/db"+nk[mindex].ns.zone.slice(0,-1)] += nk[mindex].ns.zone.substring(1) + "    IN NS " + nk[mindex].interfaces.if[f].name + "\n";
                            lab["file"][nk[mindex].name + "/etc/bind/db"+nk[mindex].ns.zone.slice(0,-1)] += nk[mindex].interfaces.if[f].name + "     IN A " + nk[mindex].interfaces.if[f].ip.split("/")[0] + "\n";
                        }
                        else {

                            var nome = nk[mindex].interfaces.if[f].name; //www.pluto.net.
                            var nomediviso = nome.split("."); //[0]www [1]pluto [2]net [3].
                            var a = ".";
                            for (var i = 1; i < nomediviso.length; i++) {
                                if (nomediviso[i] != "") {
                                    a += nomediviso[i] + ".";
                                }
                            }

                            if (typeof(authority[a]) != "undefined" && typeof(authority[a].ns.zone) != "undefined") {

                                var fileExt = authority[a].ns.zone.slice(0, -1);

                                //Evito che entri in caso di root-ns
                                if (fileExt != "") {

                                    //se è un NS inserisco il glue record
                                    if (nk[mindex].type == "ns" && nk[mindex].ns.authority) {
                                        //Creo le linee relative a me stesso nel mio file db
                                        lab["file"][nk[mindex].name + "/etc/bind/db" + nk[mindex].ns.zone.slice(0, -1)] += nk[mindex].ns.zone.substring(1) + "    IN NS " + nk[mindex].interfaces.if[f].name + "\n";
                                        lab["file"][nk[mindex].name + "/etc/bind/db" + nk[mindex].ns.zone.slice(0, -1)] += nk[mindex].interfaces.if[f].name + "    IN A " + nk[mindex].interfaces.if[f].ip.split("/")[0] + "\n";
                                        lab["file"][authority[a].name + "/etc/bind/db" + fileExt] += nk[mindex].ns.zone.substring(1) + "    IN NS " + nk[mindex].interfaces.if[f].name + "\n";
                                    }

                                    //e poi inserisco anche il record A, altirmenti solo A
                                    lab["file"][authority[a].name + "/etc/bind/db" + fileExt] += nk[mindex].interfaces.if[f].name + "    IN A " + ip + "\n";
                                }
                            }
                        }

                    }
                }
            }
        }

        // routing dinamico
        if (nk[mindex].type == 'router'){
            for (var mindex in nk) {
                if (nk[mindex].routing.rip.en || nk[mindex].routing.ospf.en) {
                    lab["file"][nk[mindex].name + ".startup"] += "/etc/init.d/zebra start\n";
                    lab["folder"][nk[mindex].name + "/etc/zebra"] = "";
                    lab["file"][nk[mindex].name + "/etc/zebra/daemons"] = "zebra=yes\n";

                    lab["file"][nk[mindex].name + "/etc/zebra/zebra.conf"] = "";
                    lab["file"][nk[mindex].name + "/etc/zebra/zebra.conf"] += "hostname zebra\n";
                    lab["file"][nk[mindex].name + "/etc/zebra/zebra.conf"] += "password zebra\n";
                    lab["file"][nk[mindex].name + "/etc/zebra/zebra.conf"] += "enable password zebra\n";
                    lab["file"][nk[mindex].name + "/etc/zebra/zebra.conf"] += "\nlog file /var/log/zebra/zebra.log\n";
                }
                if (nk[mindex].routing.rip.en) {
                    lab["file"][nk[mindex].name + "/etc/zebra/daemons"] += "ripd=yes\n";
                    lab["file"][nk[mindex].name + "/etc/zebra/ripd.conf"] = "";

                    lab["file"][nk[mindex].name + "/etc/zebra/ripd.conf"] += "hostname ripd\n";
                    lab["file"][nk[mindex].name + "/etc/zebra/ripd.conf"] += "password zebra\n";
                    lab["file"][nk[mindex].name + "/etc/zebra/ripd.conf"] += "enable password zebra\n";

                    lab["file"][nk[mindex].name + "/etc/zebra/ripd.conf"] += "\n";

                    lab["file"][nk[mindex].name + "/etc/zebra/ripd.conf"] += "router rip\n";

                    for (var n in nk[mindex].routing.rip.network)
                        lab["file"][nk[mindex].name + "/etc/zebra/ripd.conf"] += "network " + nk[mindex].routing.rip.network[n] + "\n";

                    if (typeof(nk[mindex].routing.rip.route) != "undefined" && nk[mindex].routing.rip.route != "")
                        lab["file"][nk[mindex].name + "/etc/zebra/ripd.conf"] += "route " + nk[mindex].routing.rip.route + "\n";

                    lab["file"][nk[mindex].name + "/etc/zebra/ripd.conf"] += "\n";
                }

                if (nk[mindex].routing.ospf.en) {
                    lab["file"][nk[mindex].name + "/etc/zebra/daemons"] += "ospfd=yes\n";
                    lab["file"][nk[mindex].name + "/etc/zebra/ospfd.conf"] = "";

                    lab["file"][nk[mindex].name + "/etc/zebra/ospfd.conf"] += "hostname ospfd\n";
                    lab["file"][nk[mindex].name + "/etc/zebra/ospfd.conf"] += "password zebra\n";
                    lab["file"][nk[mindex].name + "/etc/zebra/ospfd.conf"] += "enable password zebra\n";

                    lab["file"][nk[mindex].name + "/etc/zebra/ospfd.conf"] += "\n";

                    lab["file"][nk[mindex].name + "/etc/zebra/ospfd.conf"] += "router ospf\n";

                    for (var m in nk[mindex].routing.ospf.network) {
                        lab["file"][nk[mindex].name + "/etc/zebra/ospfd.conf"] += "network " + nk[mindex].routing.ospf.network[m] + " area " + nk[mindex].routing.ospf.area[m] + "\n";
                        if(nk[mindex].routing.ospf.stub[m]) {
                            lab["file"][nk[mindex].name + "/etc/zebra/ospfd.conf"] += "area " + nk[mindex].routing.ospf.area[m] + " stub\n";
                        }
                    }
                    lab["file"][nk[mindex].name + "/etc/zebra/ospfd.conf"] += "\n";
                }

                //nb: mantenere l'ordine
                if (nk[mindex].routing.rip.en && nk[mindex].routing.rip.connected) {
                    lab["file"][nk[mindex].name + "/etc/zebra/ripd.conf"] += "redistribute connected\n";
                }
                if (nk[mindex].routing.ospf.en && nk[mindex].routing.ospf.connected) {
                    lab["file"][nk[mindex].name + "/etc/zebra/ospfd.conf"] += "redistribute connected\n";
                }
                if (nk[mindex].routing.rip.en && nk[mindex].routing.rip.ospf) {
                    lab["file"][nk[mindex].name + "/etc/zebra/ripd.conf"] += "redistribute ospf\n";
                }
                if (nk[mindex].routing.ospf.en && nk[mindex].routing.ospf.rip){
                    lab["file"][nk[mindex].name + "/etc/zebra/ospfd.conf"] += "redistribute rip\n";
                }

                //nb: i costi vanno qui alla fine
                if (nk[mindex].routing.ospf.en) {
                    for (var face in nk[mindex].routing.ospf.if) {
                        if (nk[mindex].routing.ospf.if[face].cost != "" && typeof(nk[mindex].routing.ospf.if[face].cost) != "undefined") {
                            lab["file"][nk[mindex].name + "/etc/zebra/ospfd.conf"] += "interface eth" + nk[mindex].routing.ospf.if[face].interface + "\n";
                            lab["file"][nk[mindex].name + "/etc/zebra/ospfd.conf"] += "ospf cost " + nk[mindex].routing.ospf.if[face].cost + "\n";
                        }
                    }
                }

                //nb: e infine i log
                if (nk[mindex].routing.rip.en) {
                    lab["file"][nk[mindex].name + "/etc/zebra/ripd.conf"] += "\nlog file /var/log/zebra/ripd.log\n";
                }
                if (nk[mindex].routing.ospf.en) {
                    lab["file"][nk[mindex].name + "/etc/zebra/ospfd.conf"] += "\nlog file /var/log/zebra/ospfd.log\n";
                }

            }
        }
        return lab;
    }

    function makeScript(lab){
        var text="";

        text += "# Ricordati di usare prima 'chmod +x' (o 'chmod 500') sullo script per renderlo eseguibile. Lo script si autodistrugge al termine\n";

        text += "\n";

        text += "#! /bin/sh\n";

        for(var folderName in lab["folder"]){
            text += "mkdir -p " + folderName + "\n";
        }
        for(var fileName in lab["file"]){
            text += "touch " + fileName + "\n";
            var lines = lab["file"][fileName].split("\n");
            for(var lineIndex in lines) {
                text += "echo '" + lines[lineIndex] + "' >> " + fileName + "\n";
            }
        }

        text += "rm $0\n";

        return text;
    }

    function makeZip(lab){
        var zip = new JSZip();

        for(var folderName in lab["folder"]){
            zip.folder(folderName);
        }
        for(var fileName in lab["file"]){
            zip.file(fileName, lab["file"][fileName]);
        }
        var content = zip.generate({type:"blob"});
        saveAs(content, "lab.zip");
    }

    /*===============================================================================================================

     Controller

     ================================================================================================================*/

    var app = angular.module('napp', []);
    app.config(['$compileProvider',
        function ($compileProvider) {
            $compileProvider.aHrefSanitizationWhitelist(/^\s*(https?|local|data):/);
        }
    ]);

    app.controller('nc', function($scope) {

        var backbone = {
            "name":"",
            "row":1,
            "type":"router",
            "interfaces":{"counter":1, "if":[{"eth":{"number":0}, "ip":""}]},
            "gateways":{"counter":1, "gw":[{"route":"", "if":0}]},
            "pc":{"dns":""},
            "ws":{"userdir":false},
            "ns":{"recursion":true, "authority":true},
            "routing":{
                "rip":{"en":false, "connected":true, "ospf": false, "network":[""]},
                "ospf":{"en":false, "connected":true, "rip": false, "if":[], "network":[""], "area":["0.0.0.0"], "stub":[false]}
            }
        };

        $scope.netkit = [JSON.clone(backbone)];
        $scope.counter = 1;

        $scope.addMachine = function() {
            $scope.counter++;
            var p = JSON.clone(backbone);
            p.row=$scope.counter;
            $scope.netkit.push(p);
        };

        $scope.removeMachine = function() {
            if($scope.counter>1 && confirm("Sicuro di voler rimuovere la macchina?")) {
                $scope.netkit.pop();
                $scope.counter--;
            }
        };

        $scope.addInterface = function(machine) {
            machine.interfaces.if.push({"eth":{"number":machine.interfaces.counter}});
            machine.interfaces.counter++;
        };

        $scope.removeInterface = function(machine) {
            if(machine.interfaces.counter>1 && confirm("Sicuro di voler rimuovere l'interfaccia?")) {
                machine.interfaces.if.pop();
                machine.interfaces.counter--;
            }
        };

        $scope.addGateway = function(machine) {
            machine.gateways.counter++;
            machine.gateways.gw.push({"route":"", "if":0});
        };

        $scope.removeGateway = function(machine) {
            if(machine.gateways.counter>1 && confirm("Sicuro di voler rimuovere il gateway?")) {
                machine.gateways.gw.pop();
                machine.gateways.counter--;
            }
        };

        $scope.addRipNetwork = function(machine) {
            machine.routing.rip.network.push("");
        };

        $scope.removeRipNetwork = function(machine) {
            if(machine.routing.rip.network.length>1 && confirm("Sicuro di voler rimuovere il network?")) {
                machine.routing.rip.network.pop();
            }
        };

        $scope.addOspfNetwork = function(machine) {
            machine.routing.ospf.network.push("");
            machine.routing.ospf.area.push("0.0.0.0");
            machine.routing.ospf.area.stub(false);
        };

        $scope.removeOspfNetwork = function(machine) {
            if(machine.routing.ospf.network.length>1 && confirm("Sicuro di voler rimuovere il network?")) {
                machine.routing.ospf.network.pop();
                machine.routing.ospf.area.pop();
                machine.routing.ospf.stub.pop();
            }
        };

        $scope.makeDownload = function(text, filename) {
            var blob = new Blob([text], {type: "text/plain;charset=utf-8"});
            saveAs(blob, filename);
        };

        $scope.generateScript = function(nk) {
            return makeScript(makeFileStructure(nk));
        };

        $scope.generateConfig = function(nk) {
            return JSON.stringify(nk, undefined, 4);
        };

        $scope.generateZip = function(nk) {
            return makeZip(makeFileStructure(nk));
        };

        $scope.import = function() {
            try {
                var f = document.getElementById('file').files[0];
                var r = new FileReader();
                if (typeof(f) != "undefined") {
                    r.onloadend = function (e) {
                        try {
                            $scope.netkit = JSON.parse(e.target.result.substring(e.target.result.indexOf("["))); // rimozione caratteri di codifica
                            $scope.$apply();
                        }
                        catch (err) {
                            alert("Errore: " + err);
                        }
                    };
                    r.readAsBinaryString(f);
                }
                else alert("Nessun file selezionato");
            }
            catch (err) {
                alert("Errore File Reader: " + err);
            }
        }
    });

    // startup
    window.onload= function() {
        console.log("  _______          __   __   .__  __    \n  \\      \\   _____/  |_|  | _|__|/  |_  \n  /   |   \\_/ __ \\   __\\  |/ /  \\   __\\ \n /    |    \\  ___/|  | |    <|  ||  |   \n \\____|__  /\\___  >__| |__|_ \\__||__|   \n         \\/     \\/          \\/         ");
        console.log(" =======================================\n Good job for finding this page. Your     \n life with Netkit will be a lot easier!      \n ======================================= ");
    }

</script>

</body>
</html>